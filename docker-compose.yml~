version: "3.7"

#creating a common contexxt for all our services
x-common-dev: &common-JumiaABmicroservices      
  build:
    context: .
    dockerfile: Dockerfile.dev           
  volumes:
    - ./:/JumiaABmicroservices

services:
  arangodb:
    image: arangodb:3.7
    environment:
      ARANGO_ROOT_PASSWORD: rootpassword
    ports:
      - 8530:8529
    volumes:
      - db_container:/var/lib/arangodb3
    

  service_a:
    <<: *common-JumiaABmicroservices
    command: go run ./service_A
    environment:
      ARANGODB_DB: jumia_ab_microservices
      APP_PORT: 60002
    ports:
      - 60002:60002
      
  service_b:
    <<: *common-JumiaABmicroservices
    command: go run ./service_B
    environment:
      ARANGODB_DB: jumia_ab_microservice
      APP_PORT: 60001
    ports:
      - 60005:60001
    links:
      - arangodb

  graphql:
    <<: *common-JumiaABmicroservices
    command: go run ./graph_api
    environment:
      SERVICEB_SERVICE: service_B:60001
      GRAPH_API_PORT: 8080
    ports:
      - 8080:8080
    links:
      - service_b

volumes:
  db_container:

   
